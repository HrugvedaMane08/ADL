Step 1 – Install Prerequisites

sudo apt-get update
sudo apt-get install -y wget build-essential unzip openssl libssl-dev apache2 php libapache2-mod-php php-gd libgd-dev

Step 2 – Create Nagios User and Groups

sudo adduser nagios
sudo groupadd nagcmd
sudo usermod -a -G nagcmd nagios
sudo usermod -a -G nagcmd www-data

Step 3 – Install Nagios Core

cd /opt/
sudo wget https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.4.3.tar.gz
sudo tar xzf nagios-4.4.3.tar.gz
cd nagios-4.4.3

sudo ./configure --with-command-group=nagcmd
sudo make all
sudo make install
sudo make install-init
sudo make install-daemoninit
sudo make install-config
sudo make install-commandmode
sudo make install-exfoliation

sudo cp -R contrib/eventhandlers/ /usr/local/nagios/libexec/
sudo chown -R nagios:nagios /usr/local/nagios/libexec/eventhandlers

Step 4 – Configure Apache Authentication

sudo nano /etc/apache2/conf-available/nagios.conf

Paste the following inside:

ScriptAlias /nagios/cgi-bin "/usr/local/nagios/sbin"
<Directory "/usr/local/nagios/sbin">
    Options ExecCGI
    AllowOverride None
    Order allow,deny
    Allow from all
    AuthName "Restricted Area"
    AuthType Basic
    AuthUserFile /usr/local/nagios/etc/htpasswd.users
    Require valid-user
</Directory>

Alias /nagios "/usr/local/nagios/share"
<Directory "/usr/local/nagios/share">
    Options None
    AllowOverride None
    Order allow,deny
    Allow from all
    AuthName "Restricted Area"
    AuthType Basic
    AuthUserFile /usr/local/nagios/etc/htpasswd.users
    Require valid-user
</Directory>

Step 5 – Create Nagios Web Login

sudo htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadmin
sudo a2enconf nagios
sudo a2enmod cgi rewrite
sudo systemctl restart apache2

Step 6 – Install Nagios Plugins

cd /opt
sudo wget http://www.nagios-plugins.org/download/nagios-plugins-2.2.1.tar.gz
sudo tar xzf nagios-plugins-2.2.1.tar.gz
cd nagios-plugins-2.2.1

sudo ./configure --with-nagios-user=nagios --with-nagios-group=nagios --with-openssl
sudo make
sudo make install

Step 7 – Verify 

/usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg

 if permission denied (/usr/local/nagios/bin/nagios: Permission denied)
follow below command:

ls -l /usr/local/nagios/bin/nagios
sudo chmod +x /usr/local/nagios/bin/nagios
sudo chown nagios:nagcmd /usr/local/nagios/bin/nagios

Now verify Nagios configuration again
/usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg

Step 8 and Start Nagios

sudo service nagios start
sudo systemctl enable nagios

Step 9 – Access Nagios Web Interface

Open browser and go to: http://127.0.0.1/nagios/
Username: nagiosadmin
Password: 123456


 

